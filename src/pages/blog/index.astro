---
import { parseISO, isBefore } from 'date-fns';
import {
  Container,
  TextCardSection,
  BlogPostsList,
} from '@components/odyssey-theme';
import Layout from '../../layouts/Page.astro';

const posts = await Astro.glob('./posts/*.mdx').then((posts) =>
  posts
    .map(({ frontmatter, url }) => ({
      title: frontmatter.title,
      description: frontmatter.description,
      authors: frontmatter.authors,
      publishDate: parseISO(frontmatter.publishDate), // <-- adatto a "2025-12-08"
      featuredImage: frontmatter.featuredImage,
      excerpt: frontmatter.excerpt,
      href: url,
    }))
    .sort((a, b) => {
      if (isBefore(a.publishDate, b.publishDate)) return 1;
      if (isBefore(b.publishDate, a.publishDate)) return -1;
      return 0;
    })
);

const seo = {
  title: 'Blog | EvOCRO',
  description: 'Stories, updates and field notes from the EvOCRO project.',
};
---

<Layout seo={seo}>
  <Container>
    <TextCardSection>
      <h1>Blog</h1>
      <p>
        Stories from the field, project updates and behind-the-scenes notes from the EvOCRO team.
      </p>
      {/* Se vuoi tenere la newsletter, lascia questa riga, altrimenti cancellala */}
      <!-- <NewsletterForm /> -->
    </TextCardSection>

    <section class="blog-posts-list__section">
      <h2>Recent posts</h2>
      <BlogPostsList posts={posts} />
    </section>
  </Container>
</Layout>

<style>
  .blog-posts-list__section {
    margin: var(--section-margin) auto;
  }
</style>
